{% extends 'base.html.twig' %}

{% block title %}Statistiques - {{ candidat.nom }} - SecureJob{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .stats-container {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(142, 45, 226, 0.15);
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid #e0d4f7;
            transition: all 0.3s ease;
            height: 100%;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(142, 45, 226, 0.2);
            border-color: #8e2de2;
        }
        .stat-icon {
            font-size: 2.5rem;
            color: #8e2de2;
            margin-bottom: 15px;
        }
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4a00e0;
            margin: 10px 0;
        }
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0d4f7;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #8e2de2, #4a00e0);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #8e2de2;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #8e2de2;
        }
        .improvement-badge {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .trend-up { color: #4caf50; }
        .trend-down { color: #f44336; }
        .trend-neutral { color: #ff9800; }
        .competence-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }
        .competence-fill {
            height: 100%;
            border-radius: 12px;
            background: linear-gradient(90deg, #8e2de2, #4a00e0);
            position: relative;
            transition: width 1s ease;
        }
        .competence-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 600;
            z-index: 1;
        }
        .heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .heatmap-day {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .heatmap-0 { background: #ebedf0; }
        .heatmap-1 { background: #c6e48b; }
        .heatmap-2 { background: #7bc96f; }
        .heatmap-3 { background: #239a3b; }
        .heatmap-4 { background: #196127; }
    </style>
{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 style="color: #8e2de2;">
                üìà Statistiques de Performance
            </h1>
            <div class="btn-group">
                <button class="btn btn-custom" onclick="printStatistics()">
                    üñ®Ô∏è Imprimer
                </button>
                <button class="btn btn-custom" onclick="exportStatistics()">
                    üì• Exporter
                </button>
            </div>
        </div>

        <!-- Candidat header -->
        <div class="stats-container mb-4">
            <div class="row align-items-center">
                <div class="col-md-3 text-center">
                    {% if candidat.photoPath %}
                        <img src="{{ asset('uploads/photos/' ~ candidat.photoPath) }}"
                             alt="Photo"
                             style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid #8e2de2;">
                    {% else %}
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #8e2de2, #4a00e0); display: flex; align-items: center; justify-content: center; color: white; font-size: 2.5rem; margin: 0 auto;">
                            {{ candidat.nom|first }}{{ candidat.prenom|first }}
                        </div>
                    {% endif %}
                </div>
                <div class="col-md-9">
                    <h2 style="color: #4a00e0;">{{ candidat.nom }} {{ candidat.prenom }}</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <strong>Score moyen :</strong>
                            <span class="stat-value">{{ statistiques.score_moyen }}%</span>
                        </div>
                        <div class="col-md-4">
                            <strong>Entretiens :</strong>
                            <span class="stat-value">{{ statistiques.questions_reussies }}/{{ statistiques.questions_total }}</span>
                        </div>
                        <div class="col-md-4">
                            <strong>Progression :</strong>
                            <span class="improvement-badge">{{ statistiques.progression }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistiques principales -->
        <div class="row g-4 mb-4">
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-value">{{ statistiques.temps_reponse_moyen }}</div>
                    <div class="stat-label">Temps r√©ponse moyen</div>
                    <small class="trend-up">‚ñº -5s vs dernier</small>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value">{{ (statistiques.questions_reussies/statistiques.questions_total*100)|round }}%</div>
                    <div class="stat-label">Taux de r√©ussite</div>
                    <small class="trend-up">‚ñ≤ +8% ce mois</small>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value">24</div>
                    <div class="stat-label">Jours actifs</div>
                    <small class="trend-neutral">‚Üí Maintien</small>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-value">15</div>
                    <div class="stat-label">Objectifs atteints</div>
                    <small class="trend-up">‚ñ≤ +3 cette semaine</small>
                </div>
            </div>
        </div>

        <!-- Graphiques et comp√©tences -->
        <div class="row">
            <div class="col-md-8">
                <div class="chart-container">
                    <h4 style="color: #8e2de2;">üìä Progression mensuelle</h4>
                    <div style="height: 300px; position: relative; margin-top: 20px;">
                        <!-- Graphique simul√© -->
                        <div class="timeline">
                            <div class="timeline-item">
                                <strong>Semaine 1</strong> - Score initial: 65%
                                <span class="badge bg-light text-dark float-end">+5 entretiens</span>
                            </div>
                            <div class="timeline-item">
                                <strong>Semaine 2</strong> - Am√©lioration technique: 72%
                                <span class="badge bg-light text-dark float-end">Focus: JavaScript</span>
                            </div>
                            <div class="timeline-item">
                                <strong>Semaine 3</strong> - Progression continue: 78%
                                <span class="badge bg-light text-dark float-end">+3 comp√©tences</span>
                            </div>
                            <div class="timeline-item">
                                <strong>Cette semaine</strong> - Score actuel: {{ statistiques.score_moyen }}%
                                <span class="improvement-badge float-end">{{ statistiques.progression }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="chart-container">
                    <h4 style="color: #8e2de2;">üî• Activit√© r√©cente</h4>
                    <div class="heatmap">
                        {% for i in 1..35 %}
                            <div class="heatmap-day heatmap-{{ random(0, 4) }}">
                                {{ i }}
                            </div>
                        {% endfor %}
                    </div>
                    <div class="mt-3 text-center">
                        <small class="text-muted">Calendrier d'activit√© - Plus la couleur est fonc√©e, plus l'activit√© est intense</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comp√©tences √©valu√©es -->
        <div class="chart-container mt-4">
            <h4 style="color: #8e2de2;">üõ†Ô∏è Niveau par comp√©tence</h4>
            {% for competence in statistiques.competences_evaluees %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>{{ competence }}</span>
                        <span>{{ 60 + loop.index * 10 }}%</span>
                    </div>
                    <div class="competence-bar">
                        <div class="competence-fill" style="width: {{ 60 + loop.index * 10 }}%;">
                            <span class="competence-label">{{ 60 + loop.index * 10 }}%</span>
                        </div>
                    </div>
                </div>
            {% endfor %}

            {% if statistiques.competences_evaluees|length == 0 %}
                <div class="alert alert-info">
                    Aucune comp√©tence √©valu√©e pour le moment.
                    <a href="{{ path('simulateur_entretien', {'id': candidat.id}) }}" class="alert-link">
                        Commencer un entretien
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Insights IA -->
        <div class="stats-container mt-4">
            <h4 style="color: #4a00e0;">ü§ñ Insights de l'IA</h4>
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="alert" style="background: #e8f5e9; border-color: #4caf50;">
                        <h6>‚úÖ Points positifs</h6>
                        <ul class="mb-0">
                            <li>Progression constante chaque semaine</li>
                            <li>Excellent taux de participation</li>
                            <li>Am√©lioration notable en communication</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="alert" style="background: #fff3e0; border-color: #ff9800;">
                        <h6>üìà Opportunit√©s</h6>
                        <ul class="mb-0">
                            <li>Travailler les tests techniques avanc√©s</li>
                            <li>R√©duire le temps de r√©ponse de 10%</li>
                            <li>Diversifier les types d'entretiens</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="d-flex justify-content-between mt-4">
            <a href="{{ path('candidat_show', {'id': candidat.id}) }}" class="btn btn-custom">
                ‚Üê Retour au profil
            </a>
            <div>
                <a href="{{ path('feedback_ia', {'id': candidat.id}) }}" class="btn btn-custom me-2">
                    ü§ñ Feedback IA
                </a>
                <a href="{{ path('simulateur_index') }}" class="btn btn-custom">
                    üé§ Nouvel entretien
                </a>
            </div>
        </div>
    </div>

    <script>
        function printStatistics() {
            window.print();
        }

        function exportStatistics() {
            alert('Export des statistiques en cours...');
            // Ici, tu pourrais ajouter une logique pour exporter en PDF ou Excel
        }

        // Animation des barres de comp√©tences
        document.addEventListener('DOMContentLoaded', function() {
            const bars = document.querySelectorAll('.competence-fill');
            bars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });
        });
    </script>
{% endblock %}
